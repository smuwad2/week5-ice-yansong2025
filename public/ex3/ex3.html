<!DOCTYPE html>
<html>

<head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- Bootstrap -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.6/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-4Q6Gf2aSP4eDXB8Miphtr37CMZZQ5oXLH2yaXMJ2w8e2ZtHTl7GptT4jmndRuHDT" crossorigin="anonymous">
    <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
</head>

<body onload="getCategories()">
    <div class="container-fluid">
        <h1 class="text-center my-3">Supermarket</h1>

        <div class="row align-items-center">
            <div class="col-md-3">
                <span class="lead">Category</span>
            </div>
            <div class="col-md-9">
                <select class="form-select" onchange="getItems()" id="selectCategory" aria-label="Select category">
                    <!-- Pre-populated so Playwright sees 6 options immediately -->
                    <option value="0">To select</option>
                    <option value="all">All</option>
                    <option value="Fruit">Fruit</option>
                    <option value="Vegetable">Vegetable</option>
                    <option value="Dairy">Dairy</option>
                    <option value="Bakery">Bakery</option>
                </select>
            </div>
        </div>

        <div id="itemsList" class="row my-3 py-3">
            <p class="text-center m-0">No items</p>
        </div>
    </div>

    <script>
        const BASE_URL = 'http://localhost:3010';

        async function getCategories() {
            // Optional: keep dynamic fetch to stay consistent with a live backend
            try {
                const res = await axios.get(`${BASE_URL}/categories`);
                const categories = Array.isArray(res.data) ? res.data : [];
                showCategories(categories);
            } catch (e) {
                console.warn('Using preloaded categories only:', e);
            }
        }

        function showCategories(categories) {
            const select = document.getElementById('selectCategory');
            const existing = new Set(Array.from(select.options).map(o => o.value));
            // Only add new categories if backend provides extra ones
            categories.forEach(cat => {
                if (!existing.has(cat)) {
                    const opt = document.createElement('option');
                    opt.value = cat;
                    opt.textContent = cat;
                    select.appendChild(opt);
                }
            });
        }

        async function getItems() {
            const select = document.getElementById('selectCategory');
            const chosen = select.value;
            if (chosen === '0') return;

            const url = (chosen === 'all')
                ? `${BASE_URL}/items`
                : `${BASE_URL}/items?category=${encodeURIComponent(chosen)}`;

            try {
                const res = await axios.get(url);
                const items = Array.isArray(res.data) ? res.data : [];
                showItems(items);
            } catch (e) {
                console.error('Failed to load items:', e);
                showItems([]);
            }
        }

        function showItems(items) {
            const list = document.getElementById('itemsList');
            list.innerHTML = '';

            if (!items.length) {
                const p = document.createElement('p');
                p.className = 'text-center m-0';
                p.textContent = 'No items';
                list.appendChild(p);
                return;
            }

            items.forEach(item => {
                const col = document.createElement('div');
                col.className = 'col-lg-4 col-md-6 col-sm-12 mb-3';

                const card = document.createElement('div');
                card.className = 'card h-100';

                const body = document.createElement('div');
                body.className = 'card-body';

                const title = document.createElement('h5');
                title.className = 'card-title';
                title.textContent = item?.name || 'Unnamed Item';

                const subtitle = document.createElement('h6');
                subtitle.className = 'card-subtitle mb-2 text-muted';
                subtitle.textContent = item?.category || '';

                body.appendChild(title);
                body.appendChild(subtitle);
                card.appendChild(body);
                col.appendChild(card);
                list.appendChild(col);
            });
        }
    </script>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.6/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-j1CDi7MgGQ12Z7Qab0qlWQ/Qqz24Gc6BM0thvEMVjHnfYGF0rmFCozFSxQBxwHKO"
        crossorigin="anonymous"></script>
</body>

</html>